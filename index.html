<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Magnum Interview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Magnum UI styles -->
  <link rel="stylesheet" href="./magnum.min.css" />

  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #f6f7f9;
      color: #1f2328;
    }
    header {
      background: white;
      border-bottom: 1px solid #e6e8eb;
      padding: 12px 16px;
      font-weight: 600;
    }
    .container {
      max-width: 1200px;
      margin: 24px auto;
      padding: 0 16px 32px;
    }
    .card {
      background: white;
      border: 1px solid #e6e8eb;
      border-radius: 12px;
      padding: 0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
      overflow: hidden;
    }
    .notice {
      margin: 0 0 16px 0;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid #ffe69c;
      background: #fff3cd;
      color: #664d03;
    }
    .notice.error {
      border-color: #f5c2c7;
      background: #fdeaea;
      color: #7a1f1f;
    }
    magnum-interview {
      display: block;
      min-height: 70vh; /* so you see a canvas even before content renders */
    }
  </style>
</head>
<body>
  <header>Magnum Interview</header>

  <div class="container">
    <div id="status" class="notice">Initializing…</div>

    <div class="card">
      <!-- The Interview Display Component (attributes set by the script below) -->
      <magnum-interview></magnum-interview>
    </div>
  </div>

  <!-- Magnum UI web components -->
  <script src="./magnum.min.js" defer></script>
  <!-- Cloud/session helper: listens for magnum-interview creation & session token changes -->
  <script src="./magnum-cloud-security.min.js" defer></script>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');            // ?token=...
      const caseId = params.get('caseId');          // optional: ?caseId=...
      const lang = params.get('lang');              // optional: ?lang=en (if supported)

      const statusEl = document.getElementById('status');
      const interview = document.querySelector('magnum-interview');

      // --- REQUIRED ATTRIBUTES (per Swiss Re docs) ---
      // base-url points to /togo/engine/rest (no trailing slash)
      interview.setAttribute('base-url', 'https://emea.sbox.magnumswissre.com/togo/engine/rest');
      interview.setAttribute('v1-prefix', '/v1');
      interview.setAttribute('v2-prefix', '/v2');

      // Customer Journey Analytics config base
      interview.setAttribute('event-collector-config-base-url', 'https://emea.sbox.magnumswissre.com/togo');

      // Optional UI config
      interview.setAttribute('menu-mode', 'sidebar');
      interview.setAttribute('menu-state', 'enabled');

      // Optional language (if your environment supports it)
      if (lang) interview.setAttribute('language', lang);

      // Case id can be provided; the cloud security helper will also set it after auth if server returns one
      if (caseId) interview.setAttribute('case-id', caseId);

      // Token handling
      if (token && token.trim()) {
        // IMPORTANT: set the token *after* base-url so the cloud security script can authenticate
        interview.setAttribute('security-session-token', token.trim());
        statusEl.textContent = 'Session token loaded from URL.';
      } else {
        statusEl.classList.add('error');
        statusEl.innerHTML = 'No <code>token</code> URL parameter found. Append <code>?token=YOUR_SESSION_TOKEN</code> to the page URL.';
      }

      // (Optional) basic overlay feedback hooks if your bundle dispatches these events
      interview.addEventListener('magnum-overlay-show', () => {
        statusEl.textContent = 'Loading…';
        statusEl.classList.remove('error');
      });
      interview.addEventListener('magnum-overlay-hide', () => {
        statusEl.textContent = 'Ready.';
      });

      // (Optional) error feedback
      interview.addEventListener('magnum-application-error', (e) => {
        statusEl.classList.add('error');
        statusEl.textContent = 'An application error occurred' + (e.detail?.message ? `: ${e.detail.message}` : '.');
      });
    });
  </script>
</body>
</html>
