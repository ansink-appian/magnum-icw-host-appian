/*
 * Copyright Swiss Reinsurance Company, Mythenquai 50/60, CH 8022 Zurich. All rights reserved.
 * Magnum UI Components 1.16.0.0 (f3ec70bf21c3799faadae0ef337900805f22ebe3)
 */
!function(){let e,t,n=!1,s=window.MAGNUM_TRANSLATIONS&&window.MAGNUM_TRANSLATIONS[window.MAGNUM_DEFAULT_LANGUAGE]||{};class i{constructor({idleTimeout:e,sessionLength:t,idleWarningPercentage:n,sessionRefreshEnabled:s,onIdleTimeout:i,onSessionExpired:o}){this.idleTimeout=e,this.idleTimeoutSeconds=60*this.idleTimeout,this.idleWarningSeconds=60*Math.floor(this.idleTimeoutSeconds*Math.max(30,Math.min(90,n||50))/100/60),this.sessionLength=t,this.sessionLengthSeconds=60*this.sessionLength,this.sessionRefreshEnabled=s,this.onIdleTimeout=i,this.onSessionExpired=o,this.start()}tick(){this.idle=0,this.remainingTime=0}start(){this.stop(),this.timer=setInterval(()=>{if(this.session++,this.idle++,this.idle>this.idleWarningSeconds&&this.sessionRefreshEnabled){const e=Math.max(this.sessionLength-Math.floor(this.session/60),1),t=Math.max(this.idleTimeout-Math.floor(this.idle/60),1),n=Math.min(e,t);this.remainingTime!==n&&this.onIdleTimeout(this.remainingTime=n)}(this.idle>this.idleTimeoutSeconds||this.session>this.sessionLengthSeconds)&&(this.stop(),this.onSessionExpired())},1e3)}stop(){clearInterval(this.timer),this.session=0,this.idle=0}}const o=()=>{e&&e.stop()};document.addEventListener("magnum-interview-created",async a=>{if(n)return;n=!0,t=a.target,t.addEventListener("magnum-application-error",e=>{e.detail&&"4049"===e.detail.code||o()}),t.addEventListener("magnum-interview-removed",()=>{n=!1,o()}),t.addEventListener("magnum-interview-language-change-succeeded",e=>{s=window.MAGNUM_TRANSLATIONS[e.detail in window.MAGNUM_TRANSLATIONS?e.detail:window.MAGNUM_DEFAULT_LANGUAGE],e.target.translations=s});let c=await function(e,t){return new Promise(t=>{l(e,"base-url",(function(e,n){n&&n.disconnect(),t(e)}))})}(t);c=(c||"").replace(/\/$/,"");const h=(c+"/").replace(/\/engine\/.*$/,"").replace(/\/$/,"");function u(e){const t=e.url.includes("://")?e.url:e.baseURL+e.url,n=e.params?"?"+e.params.toString():"";return fetch(t+n,{method:e.method,headers:{"Content-Type":"application/json",Accept:"application/json","MXG-Authorization":e.sessionToken},body:e.data?JSON.stringify(e.data):null}).then(e=>e.ok?e:(e.headers.get("Content-Type")||"").includes("application/json")?e.json().then(e=>Promise.reject(e)):Promise.reject(e.statusText)).then(async e=>{try{return JSON.parse(await e.text())}catch(t){return{}}})}l(t,"security-session-token",n=>u({method:"POST",url:"/interview/v1/authenticate",baseURL:h,sessionToken:n}).then(n=>{let s;function o(){if(s)return s.decline();d(t,r("ERROR_SESSION_INVALIDATION"),()=>{t.dispatchEvent(new CustomEvent("magnum-session-timeout",{bubbles:!0,cancelable:!1}))},!0)}e&&e.stop(),e=new i({idleTimeout:n.idleTimeout,sessionLength:n.sessionLength,idleWarningPercentage:parseInt(t.getAttribute("session-idle-warning-percentage"),10),sessionRefreshEnabled:!t.hasAttribute("no-session-refresh"),onIdleTimeout:function(i){const a=r("WARNING_SESSION_EXPIRATION",{minutes:""+i});if(s)return s.setMessage(a);s=function(e,t,n,s){const i=document.createElement("magnum-dialog-warning");return e.appendChild(i),i.setMessage=e=>i.labels={WARNING_ALERT_TITLE:r("WARNING_ALERT_TITLE"),LANGUAGE_CHANGE:e,BTN_LABEL_YES:r("BTN_LABEL_YES"),BTN_LABEL_NO:r("BTN_LABEL_NO")},i.setMessage(t),i.addEventListener("magnum-dialog-confirm",()=>{e.removeChild(i),n&&n()}),i.addEventListener("magnum-dialog-decline",()=>{e.removeChild(i),s&&s()}),i}(t,a,()=>{s=null,u({method:"POST",url:"/token/v1/heartbeat",baseURL:h,sessionToken:n.sessionToken}).then(()=>e.tick())},()=>{e.stop(),s=null,o()})},onSessionExpired:o}),null===t.getAttribute("case-id")&&n.caseUUID&&t.setAttribute("case-id",n.caseUUID),t.setRequestHandler(t=>u({baseURL:c,sessionToken:n.sessionToken,url:t.url,method:t.method,data:t.data,params:t.params}).then(t=>(e.tick(),t)))}).catch(()=>{d(t,r("ERROR_TECHNICAL"),()=>t.dispatchEvent(new CustomEvent("magnum-application-error-confirmed",{bubbles:!0,cancelable:!1})))}))});const a=new RegExp("{[^{}]+}","g");function r(e,t){const n=s[e]||e;return t?(i=t,n.replace(a,e=>i[e.slice(1,-1)]||"")):n;var i}function d(e,t,n,s=!1){const i=document.createElement("magnum-dialog-error");return e.appendChild(i),i.labels={ERROR_ALERT_TITLE:r(s?"INFO_ALERT_TITLE":"ERROR_ALERT_TITLE"),BTN_LABEL_OK:r("BTN_LABEL_OK")},i.setMessage=e=>i.message=e,i.setMessage(t),i.addEventListener("magnum-dialog-decline",()=>{e.removeChild(i),n&&n()}),i}function l(e,t,n){e.hasAttribute(t)&&n(e.getAttribute(t));const s=new MutationObserver((s,i)=>{for(const o of s)"attributes"===o.type&&o.attributeName===t&&n(e.getAttribute(t),i)});return s.observe(e,{attributes:!0}),s}}();