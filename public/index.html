<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Magnum Interview (Ansink DEV)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Load Magnum UI from CDN -->
  <link rel="stylesheet" href="https://emea.sbox.magnumswissre.com/togo/cdn/magnum.min.css" />
  <script src="https://emea.sbox.magnumswissre.com/togo/cdn/magnum.min.js" defer></script>
  <script src="https://emea.sbox.magnumswissre.com/togo/cdn/magnum-cloud-security.min.js" defer></script>

  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#f6f7f9; color:#1f2328; }
    header { background:#fff; border-bottom:1px solid #e6e8eb; padding:12px 16px; font-weight:600; }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px 32px; }
    button { padding:10px 16px; border-radius:10px; border:1px solid #d0d7de; background:#fff; cursor:pointer; }
    button:hover { background:#f0f1f3; }
    .status { margin:12px 0; padding:10px 12px; border-radius:10px; border:1px solid #e6e8eb; background:#fff; }
    .status.error { border-color:#f5c2c7; background:#fdeaea; color:#7a1f1f; }
    .card { background:#fff; border:1px solid #e6e8eb; border-radius:12px; overflow:hidden; }
    magnum-interview { display:block; min-height:70vh; }
  </style>
</head>
<body>
  <header>Magnum Interview</header>
  <div class="wrap">
    <button id="startBtn">Create Case & Start Interview</button>
    <div id="status" class="status">Idle.</div>
    <div class="card">
      <magnum-interview></magnum-interview>
    </div>
  </div>

  <script>
    const RULEBASE_UUID = "ecd9a42b-a16c-4625-86a1-02ec2986a219";
    const DEFAULT_LANG = "en_GB";

    const statusEl = document.getElementById("status");
    const btn = document.getElementById("startBtn");
    const interview = document.querySelector("magnum-interview");

    // Configure static attributes
    interview.setAttribute("base-url", "https://emea.sbox.magnumswissre.com/togo/engine/rest");
    interview.setAttribute("v1-prefix", "/v1");
    interview.setAttribute("v2-prefix", "/v2");
    interview.setAttribute("event-collector-config-base-url", "https://emea.sbox.magnumswissre.com/togo");
    interview.setAttribute("menu-mode", "sidebar");
    interview.setAttribute("menu-state", "enabled");

    btn.addEventListener("click", async () => {
      statusEl.classList.remove("error");
      statusEl.textContent = "Creating case…";

      try {
        const resp = await fetch("/api/start-interview", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ rulebaseUuid: RULEBASE_UUID, languageCode: DEFAULT_LANG })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data?.error || `HTTP ${resp.status}`);

        if (!data.securitySessionToken) throw new Error("No securitySessionToken returned.");
        interview.setAttribute("security-session-token", data.securitySessionToken);

        statusEl.textContent = `Case ${data.caseId} created. Starting interview…`;
      } catch (err) {
        statusEl.classList.add("error");
        statusEl.textContent = `Failed: ${err.message || err}`;
      }
    });
  </script>
</body>
</html>